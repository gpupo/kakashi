#!/bin/bash

USERNAME=$1

if [ "x$1" = "x" ] ; then
  echo "Usage: $0 username"
  exit
fi


touch "/home/$USERNAME/.spamassassinenable"
chown "$USERNAME." "/home/$USERNAME/.spamassassinenable"

mkdir "/home/$USERNAME/.spamassassin"
chown "$USERNAME." "/home/$USERNAME/.spamassassin"

cat < "/home/$USERNAME/.spamassassin/user_prefs"
# SpamAssassin user preferences file.  See 'perldoc Mail::SpamAssassin::Conf'
# for details of what can be tweaked.
###########################################################################

# How many points before a mail is considered spam.
# required_score                5

# Whitelist and blacklist addresses are now file-glob-style patterns, so
# "friend@somewhere.com", "*@isp.com", or "*.domain.net" will all work.
# whitelist_from        someone@somewhere.com

# Add your own customised scores for some tests below.  The default scores are
# read from the installed spamassassin rules files, but you can override them
# here.  To see the list of tests and their default scores, go to
# http://spamassassin.apache.org/tests.html .
#
# score SYMBOLIC_TEST_NAME n.nn

# Speakers of Asian languages, like Chinese, Japanese and Korean, will almost
# definitely want to uncomment the following lines.  They will switch off some
# rules that detect 8-bit characters, which commonly trigger on mails using CJK
# character sets, or that assume a western-style charset is in use.
#
# score HTML_COMMENT_8BITS      0
# score UPPERCASE_25_50         0
# score UPPERCASE_50_75         0
# score UPPERCASE_75_100        0
# score OBSCURED_EMAIL          0

# Speakers of any language that uses non-English, accented characters may wish
# to uncomment the following lines.   They turn off rules that fire on
# misformatted messages generated by common mail apps in contravention of the
# email RFCs.

# score SUBJ_ILLEGAL_CHARS      0

required_score 5
rewrite_header subject *** SPAM ***
EOF

chown "$USERNAME." "/home/$USERNAME/.spamassassin/user_prefs"


cat < "/home/$USERNAME/.cpanel/filter.yaml"
---
filter:
  -
    actions:
      -
        action: save
        dest: /dev/null
    enabled: 1
        filtername: "Converted Rule : \$h_X-Spam-Bar: contains +++++"
    rules:
      -
        match: contains
        opt: or
        part: "\$h_X-Spam-Bar:"
        val: +++++
  -
    actions:
      -
        action: save
        dest: /dev/null
    filtername: Generated Apache SpamAssassinâ„¢ Discard Rule
    rules:
      -
        match: contains
        opt: or
        part: "$h_X-Spam-Bar:"
        val: +++++
EOF

chown "$USERNAME." "/home/$USERNAME/.cpanel/filter.yaml"
